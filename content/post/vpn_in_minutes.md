+++
date = "2016-09-06T17:17:19+03:00"
draft = false
slug = "vpn_in_minutes"
tags = ["go", "vpn", "ssh"]
title = "Свой VPN за две минуты"
+++

Есть прекрасная сборка сервера OpenVPN на докере: [kylemanna/openvpn](https://hub.docker.com/r/kylemanna/openvpn/), но есть один нюанс -- всё-таки для установки нужно поработать ручками. В процессе решения данной неувязочки появился [govpn](https://github.com/yanzay/govpn) -- как раз выдался хороший повод поупражняться в [SSH на Go]({{< relref "go_ssh_client_example.md" >}}). Что из этого получилось и как этим пользоватся, читаем дальше.
<!--more-->

Итак, для установки достаточно сделать традиционный

```
go get github.com/yanzay/govpn
```

после чего утилита `govpn` будет доступна из `$GOPATH/bin`.

Итак, для того чтобы развернуть собственный VPN сервер, нам нужно куда-то его установить. Я для этого использую маленький дроплет на [DigitalOcean](https://m.do.co/c/e92d1c1e2814) (осторожно, реферальная ссылка, получите $10 бонуса), на его примере и рассмотрим.

Для начала создаём дроплет:

![DigitalOcean Create Droplet](/images/do_create_droplet1.png)

Оставляем по умолчанию `Ubuntu 16.04.1 x64`, далее выбираем самый маленький сервер за $5 в месяц, определяемся с нужным регионом (я выбираю ближайший ко мне -- Frankfurt) и последнее -- нужно обязательно добавить на дроплет свой SSH ключ, мы ведь собираемся безопасно общаться с сервером.

![DigitalOcean Create Droplet](/images/do_create_droplet2.png)
![DigitalOcean Create Droplet](/images/do_create_droplet3.png)

После чего смело жмём "Create" и осталось подождать несколько секунд пока новый дроплет создаётся.

![DigitalOcean Create Droplet](/images/do_create_droplet4.png)

Сразу копируем IP-адрес, он нам сейчас понадобится. Осталось только запустить магический `govpn`, который дальше сам разберётся что делать:

```
$ # указываем пользователя системы: root
$ # в host передаём IP адрес свежего дроплета
$ # --vpn-user указывает имя создаваемого VPN пользователя
$ govpn --user root --host 46.101.254.82 --vpn-user yanzay
Enter pass phrase:
```
Введём pass phrase -- она будет использоваться только для подписи новых сертификатов, в процессе пользования VPN она не понадобится.

Всё! Можно откинуться на спинку кресла и подождать минутку (у меня это заняло `0.13s user 0.14s system 1% cpu 24.951 total`, но так бывает не всегда -- подбор параметров Диффи-Хеллмана может занять дольше), после чего у вас в текущей папочке появится файл `<vpn-user>.ovpn` (в моём случае `yanzay.ovpn`), который тут же можно добавлять в [Tunnelblick](https://tunnelblick.net/) и подключаться к серверу.

Для того, чтобы добавить нового пользователя к существующему серверу, добавим параметр `--create-user`:
```
$ govpn --user root --host 46.101.254.82 --vpn-user friend --create-user
```

Наслаждайтесь безопасными соединениями, удачи!
